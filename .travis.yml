language: android
sudo: required
jdk: oraclejdk8
before_cache:
- rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/
env:
  global:
  - APP_NAME=aardvark
  - ANDROID_API=27
  - EMULATOR_API=21
  - ANDROID_BUILD_TOOLS=27.0.2
  - ADB_INSTALL_TIMEOUT=5
android:
  components:
  - tools
  - platform-tools
  - build-tools-$ANDROID_BUILD_TOOLS
  - android-$ANDROID_API
  - android-$EMULATOR_API
  - extra-android-support
  - extra-android-m2repository
  - extra-google-google_play_services
  - sys-img-armeabi-v7a-android-$ANDROID_API
  - sys-img-armeabi-v7a-android-$EMULATOR_API
  licenses:
  - android-sdk-preview-license-.+
  - android-sdk-license-.+
  - google-gdk-license-.+
before_install:
- yes | sdkmanager "platforms;android-27"
- openssl aes-256-cbc -K $encrypted_7b7d53b231fa_key -iv $encrypted_7b7d53b231fa_iv
  -in secrets.tar.enc -out secrets.tar -d
- tar xvf secrets.tar
- mkdir "$ANDROID_HOME/licenses" || true
- echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" > "$ANDROID_HOME/licenses/android-sdk-license"
- echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" > "$ANDROID_HOME/licenses/android-sdk-preview-license"
- chmod +x gradlew
before_script:
- echo no | android create avd --force --name test --target android-21 --abi armeabi-v7a
- emulator -avd test -no-audio -no-window &
- android-wait-for-emulator
- adb shell input keyevent 82 &
script:
- ./gradlew clean build connectedCheck -PdisablePreDex --stacktrace
before_deploy:
- cd app/build/outputs/apk/
deploy:
  provider: releases
  file: ${APP_NAME}-$(echo ${TRAVIS_TAG//[!0-9.-]/})-release.apk
  skip_cleanup: true
  on:
    repo: Thames1990/aardvark
    tags: true
  api_key:
    secure: gjV1kuYxfGzm3t4YwCfVBD/qdifZPbbyu2vvmHmuDIZTQqW60w0f+chvCWDL6GoE2CNDhPQvc5PT3yxl5mmDRGXXTXwfHI61V9X25z+2QQ9efc71yau2OdYxgINb7L6qetq3eL/3cNQXbU1/wDNemlfH+Gu0jWzhxbN6O6OeyITd1a7pq6qtNuDzyJRN9/7hdHZcAtmwfrTB4vlLeqOjPimVTNAw0FvN4o1EGswOsJ4mmYy2MTs56bRLZuTEzydXaXL9Ocj11OnrvJd77/hWowrAiOyI6Rf0BdtoauyEwZTgYweCDOajsisW/X+lrSCjnw/pS03keV5n4Ioy6kqXABndTP8cZJatBQkycvwMy3R51i0JrVWVlQJVsf17QJEV9a8le+dUFU0nEpn+cJybpNP0yvlQSF43ltsgJk/U9VuwjFaWQYPl1wn/Bn4/t7KQlONow5gVofV0MQ48aVOeGIyCVF/aBcofGa2zVqGWVbOHd8fnrgAVkq1DJ3kXLxp8uIx2Ex78TJ5AmU4W5kfKehuQrxe3yRhuW7GkILAvatF60gw0FlH6nRu4RslU1YM/tXsq81VC81xQttGrHgC3+Rc6xTJyE2SZrioIvZu6rMXqUlo+NRw0qvoU/tMnJi+bHQI7kzN6IzDHe+7oFRv4BUolN8homDXFelzptbKNXHU=
