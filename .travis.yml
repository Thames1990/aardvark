language: android
sudo: false
dist: trusty
jdk: oraclejdk8
env:
  global:
  - APP_NAME=aardvark
  - ANDROID_API=26
  - ANDROID_BUILD_TOOLS=26.0.1
  - ADB_INSTALL_TIMEOUT=5
android:
  components:
  - tools
  - tools
  - platform-tools
  - build-tools-$ANDROID_BUILD_TOOLS
  - android-$ANDROID_API
  licenses:
  - android-sdk-preview-license-.+
  - android-sdk-license-.+
  - google-gdk-license-.+
script:
- "./gradlew build connectedCheck"
before_install:
- openssl aes-256-cbc -K $encrypted_1e0e1c84b069_key -iv $encrypted_1e0e1c84b069_iv
  -in secrets.tar.enc -out secrets.tar -d
- tar xvf secrets.tar
- mkdir "$ANDROID_HOME/licenses" || true
- echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" > "$ANDROID_HOME/licenses/android-sdk-license"
- echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" > "$ANDROID_HOME/licenses/android-sdk-preview-license"
- chmod +x gradlew
before_deploy:
- cp $TRAVIS_BUILD_DIR/production.jks $HOME
- cd app/build/outputs/apk/
- jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore $HOME/production.jks
  -storepass $storepass -keypass $keypass app-release-unsigned.apk production
- jarsigner -verify app-release-unsigned.apk
- "${ANDROID_HOME}/build-tools/${ANDROID_BUILD_TOOLS}/zipalign -v 4 app-release-unsigned.apk ${APP_NAME}-${TRAVIS_TAG}.apk"
deploy:
  provider: releases
  file: "{APP_NAME}-${TRAVIS_TAG}.apk"
  skip_cleanup: true
  on:
    repo: Thames1990/aardvark
    tags: true
    jdk: oraclejdk8
  api_key:
    secure: YaOjd2J3rFjldscJwCn0eclpl3ck7tBHcJ6rnGLY5ggBNfRgie45FzdrTLMYgfUGZcDbMHTi4GU8n38rjLY5CrgoN0sCcMy1V5hN76QQL5DsJq14MQ6qeXlNmjo5A9kUMBNxcb9G6VkPN0o3ioWC31sJZbGzafy8HZaBbSlba0Nf2/HkA93yaChY0A75apcQx/hMTCDDETbdkUgFkVp5/YA0uaJPprgRbSCpiAENmM7Ncz51AULpMR+FrePTIyJhuG0PnlKwdkExhpDrCql9dql90OMGuS6t0ErsQkjModMjFue63wB6tlGotmOG+9u9ZxDK3FuqJmweLeE3Eg0Dvs+DI9DFmHjDGNShRgsO0foOuThFoRB10VT+CgAXnqvqRJ7y3e5voK35r09rP8UdX5FUotdH1ayaVO/DafACbQvaIJKZY7ezNkfvi8t5Sl893C+4XiLRRsFtvoGJeCCFx3su9CVjHE5furpB/d/YRV8RXjCmFviAIUES2T+R233vRmPSNIDVoTKZxGj9OyQx6JgqeL7TkySqCrXvYTpw2jnQtzHiEPtgTewc5lSf4+2rXYfesmlrnrQm/jLTbdIXZjoHu5bH9qlZOKODhQAjBD2uFdhM+ZiROHP3S2RYJMH3PUU6BuwGhlh4CcNm88a28pOSr3GNsW+gbrgKKPQdDKk=
before_cache:
- rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
