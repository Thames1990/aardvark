language: android
sudo: false
jdk: oraclejdk8
before_cache:
- rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
env:
  global:
  - APP_NAME=aardvark
  - ANDROID_API=26
  - ANDROID_BUILD_TOOLS=26.0.1
  - ADB_INSTALL_TIMEOUT=5
  - secure: cZgR8Sy9tuOaeKgE+p45ZxgLyMaLlKMWi/tBHy26yLNn15JcFG05SDl41p2Nx9vamytLymTIivywBPmh6M+QEHP9PBuRI0qqhwB95p5HjQ24PqzjU5PEXTg43YNFVt5PTp4oMFNEia92DZUi+2kri031n/wIdw/qcCltzMg9eDQqbrUefOBY7vHdKbax5j2g7pX30pgf7LaQzu5Z5PFJ246eI/yChSolxjaUQjPJzdP41B5Vq8NmiZbtIivfI3u+MrXGvOY/eRCzBRXLjQeFeFgXu4rvYV8KhsOij+AT0OgMXjTWnWVnCE8C6Ui+Y/h3yaKBFYNOhfi6ZiBUWL9VwZEdhdsWJwx9zyhnXXtxt6Z8y0+x+wdQjP8Ybc2FgFNUtuYVQC8mJ1t/LMuVyue2jjBgNjQQjQE8er8ZU9AXPiDYLpDGl1KXrCJ360t/9XxZqXBfLpFuDSsZP5BCGhxEFvXO3cD+TkY+YzTDrScQgsG9EDkNTRD6VhC9crBCJ1BUDXACRSqcdpJRfREPF4gHyAB3Ilc5EX/9DpMgaQ3mNlEouUI5efzREVsxUzAnljo9B8Er0R2q74P11VcyOzDSkqVwIKH1aS4ydVopJrrzUj/M+dRgy2GxEDZH/CELBX2QyFwb+Q8gDDNMdOkcQAYAQ02RNrD0vVLZH36RpmeGsCU=
  - secure: EiPY8Vgxpr8l294VniV0fTtd7jkuIGz2KFipjCeVLlGVrSLVI77/1dT+qdxpCdToaum3eWPXB2M8Xao7CGEs+/3D0+hDjCj/hEF+sPHhfb7oK7NNldQI49HIQg8dhh0pXSnyRpYAL/Guw8I+wohD3tVHA7tGcXpUrmelpO5I/U7pNjDrimELnCJzSsPFvqq78zyND3NyELqj/Qr4E0i6OiagnQA+5XV/OkUEPoOGbws/1NmcX0NxlWLhHl+yzw3xQ0QvSeg9hkgtIC8rBBcMJjYKNCy1/prHvmiaJKDF2AU43/6OXVG6YS39WQam8CRbFeWfRw+rg3ZH8/ukHmVo3swuU8bammlhA+l6xlQzTpMLeUC7SmKEkV5bdZtDxxwC3ZZc31/ernmp2FfRWVXozktwnAlJouSdMJojNMrmiOSl2of7Z5jqEkJP/cAXNKeJT2SZrcgPjOp+Pv79XsWPFYXzKy9uqAEQmwvLjjsvUtEixzLrFdo1iqtvLgIoPplzPqV5+UaGL8H9yo8lCf6zWnxPf1R2//hneslPdpkecokbVy0HfWdX+92+BGFoNH5f+2Lvg7TdTaAC1bjF5l0WTRWK5fz+z3qbhuj6N0nbAVyEWZvxu1LtRhzbhImCnOpDsJ3/IAkSoU+DDWvgoQ1iPW4+j8El77VJPjVWWmppbUs=
android:
  components:
  - tools
  - platform-tools
  - build-tools-$ANDROID_BUILD_TOOLS
  - android-$ANDROID_API
  - extra-android-support
  - extra-google-google_play_services
  licenses:
  - android-sdk-preview-license-.+
  - android-sdk-license-.+
  - google-gdk-license-.+
before_install:
- openssl aes-256-cbc -K $encrypted_7b7d53b231fa_key -iv $encrypted_7b7d53b231fa_iv
  -in secrets.tar.enc -out secrets.tar -d
- tar xvf secrets.tar
- mv production.jks app
- mkdir "$ANDROID_HOME/licenses" || true
- echo -e "\n8933bad161af4178b1185d1a37fbf41ea5269c55" > "$ANDROID_HOME/licenses/android-sdk-license"
- echo -e "\n84831b9409646a918e30573bab4c9c91346d8abd" > "$ANDROID_HOME/licenses/android-sdk-preview-license"
- chmod +x gradlew
script:
- "./gradlew clean build connectedCheck"
deploy:
  provider: releases
  api_key:
    secure: MNz59yfCQBaz7Ibs8i1u7Wld95cG71a/ppm9vTWRlZJS87vycoLLXtKRjCDoj6IdlLHX9/aAe/mNxHntz2mHbgNNrAMgSVkk4bBHs21RR4pdMfUO2CQhg/8wSB6ljs95SavFL9mniyGRKTyB54J+lkHJo25v0BGPUAnvQOU1Ap27Tlw/6oa6Cqoeuc3YyzpuzgEM0D0slXCVY6P82W08WnyOJhDEkAGlvWRUTnvUh6EC3cNFJ/zian/qTUoquZojQ8YojjbyXHigo9y7LWb2+vsh8SeKPq5XhIzZGLUwmhxg+aJHLV2brLf5cWS03MBLWzpIXBVtasItaYzr1z59chxhI9RdQBFYuPXqQhf1jEzupxRvxnMIOXKF7ZvbfWQ4BkjW57i6+gaz9hnHJvgSlMjvyZSMJ05lDg8SO00sSkZh3kgmWiW41XHZYY/S7psz0pDUZWTHjm6ICnSGejcEfCH07AAQz1O1BUG5aN864U/0igBNR075shqCTF0j02/xVY3eaRM+KCatGYUF3AwumADOQZsMsjibWOQACr77OxAJ4DX4uFzHNbiEPcmLniAoThdOlOVt0os4tgkt+hnRx3MBQ+McQe98e1ZmPY0eOb06k0iDYnR6LlO44OW7MX+1jEXzba6f3vn3RamDsOxEWpazklscJyiu8IAv5kVBWgM=
  file: "$APP_NAME-$($TRAVIS_TAG | cut -c 2-)-release.apk"
  skip_cleanup: true
  on:
    repo: Thames1990/aardvark
    tags : true
